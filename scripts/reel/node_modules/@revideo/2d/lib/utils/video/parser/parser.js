import { createFile } from 'mp4box';
import { FrameSampler } from './sampler';
import { Segment } from './segment';
import { MP4FileSink } from './sink';
import { description, mp4BoxEditToEdit } from './utils';
/**
 * Loads the file at the given URI until it finds the moov box.
 * Once found, it calls `setConfig` with the video configuration.
 * @param uri - The URI of the video file.
 * @param setConfig - Callback to set the video configuration.
 * @returns
 */
async function getFileInfo(uri) {
    return new Promise((res, rej) => {
        const file = createFile();
        let found = false;
        const controller = new AbortController();
        file.onReady = (info) => {
            found = true;
            controller.abort();
            const track = info.videoTracks[0];
            const config = {
                // Browser doesn't support parsing full vp8 codec (eg: `vp08.00.41.08`),
                // they only support `vp8`.
                codec: track.codec.startsWith('vp08') ? 'vp8' : track.codec,
                codedHeight: track.video.height,
                codedWidth: track.video.width,
                description: description(file, track),
            };
            const defaultEdit = {
                mediaTime: 0,
                segmentDuration: track.duration,
                mediaRateInteger: 1,
                mediaRateFraction: 0,
            };
            const editsFromVideo = track.edits?.map((edit) => mp4BoxEditToEdit(edit));
            // If there are no entries, use the default edit
            const editsWithoutFps = editsFromVideo?.length
                ? editsFromVideo
                : [defaultEdit];
            // Calculate FPS for each segment
            const edits = editsWithoutFps.map(edit => {
                const trackDurationInSec = track.duration / track.timescale;
                const segmentDurationInSec = edit.segmentDuration / track.movie_timescale;
                const segmentFrames = track.nb_samples * (segmentDurationInSec / trackDurationInSec);
                const mediaRate = edit.mediaRateInteger + edit.mediaRateFraction / 0xffff;
                const fps = (segmentFrames / segmentDurationInSec) * mediaRate;
                return { ...edit, fps };
            });
            file.setExtractionOptions(track.id);
            file.start();
            res({ file, edits, config });
        };
        return fetch(uri, { signal: controller.signal }).then(async (response) => {
            if (!response.body) {
                throw new Error('Response body is null');
            }
            const reader = response.body.getReader();
            const sink = new MP4FileSink(file, () => { });
            while (!found) {
                await reader.read().then(({ done, value }) => {
                    if (done) {
                        file.flush();
                        controller.abort();
                        rej('Could not find moov');
                        return;
                    }
                    sink.write(value);
                });
            }
        });
    });
}
export class Mp4Parser {
    constructor(uri, targetFps, startTime) {
        this.edits = [];
        this.nextSegment = 0;
        this.uri = uri;
        this.targetFps = targetFps;
        this.startTime = startTime;
    }
    async start() {
        const { file, edits, config } = await getFileInfo(this.uri);
        this.file = file;
        this.edits = edits;
        this.decoderConfig = config;
    }
    async getNextFrame() {
        // Start the first segment
        if (!this.sampler) {
            // Skip segments until the start time
            let startTimeWithinSegment = this.startTime;
            while (this.nextSegment < this.edits.length) {
                const segmentDurationInSeconds = this.getSecondDurationOfSegment(this.edits[this.nextSegment]);
                if (startTimeWithinSegment < segmentDurationInSeconds) {
                    break;
                }
                startTimeWithinSegment -= segmentDurationInSeconds;
                this.nextSegment++;
            }
            // The timestamp is outside of the video
            if (this.nextSegment >= this.edits.length) {
                throw new Error(`Timestamp ${this.startTime} is outside of the video, max timestamp is ${this.getDuration()}`);
            }
            const segment = new Segment(this.uri, this.file, this.edits, this.nextSegment, startTimeWithinSegment);
            await segment.start(this.decoderConfig);
            this.sampler = new FrameSampler(segment, this.edits[this.nextSegment].fps, this.targetFps, 0);
            this.nextSegment++;
        }
        // Try to get the next frame
        let frame = await this.sampler.getNextFrame();
        // If there are no more frames in the current segment, start the next segment
        while (!frame && this.nextSegment < this.edits.length) {
            this.sampler.getSegment().close();
            this.sampler.getLastFrame()?.close();
            const segment = new Segment(this.uri, this.file, this.edits, this.nextSegment, 0);
            await segment.start(this.decoderConfig);
            this.sampler = new FrameSampler(segment, this.edits[this.nextSegment].fps, this.targetFps, this.sampler.getSum());
            this.nextSegment++;
            frame = await this.sampler.getNextFrame();
        }
        // If there are no more frames, return the last frame
        if (!frame) {
            frame = this.sampler.getLastFrame();
            // We can close the segment
            await this.sampler.getSegment().close();
            // If we still don't have a frame, throw an error
            if (!frame) {
                throw new Error('There are no frames in the video.');
            }
        }
        return frame;
    }
    getSecondDurationOfSegment(edit) {
        const mediaRate = edit.mediaRateInteger + edit.mediaRateFraction / 0xffff;
        const duration = edit.segmentDuration / this.file.getInfo().videoTracks[0].movie_timescale;
        return duration / mediaRate;
    }
    getDuration() {
        return this.edits.reduce((acc, edit) => acc + this.getSecondDurationOfSegment(edit), 0);
    }
    getTimeSubtractingFrames(frames) {
        const durationOfPastSegmentsInSeconds = this.edits
            .slice(0, this.nextSegment - 1)
            .reduce((acc, edit) => acc + this.getSecondDurationOfSegment(edit), 0);
        if (!this.sampler) {
            throw new Error('No current segment');
        }
        const currentSegmentStartTime = this.sampler.getSegment().getStartTime();
        const samplerTime = this.sampler.getTime(frames);
        return (durationOfPastSegmentsInSeconds + currentSegmentStartTime + samplerTime);
    }
    getTime() {
        return this.getTimeSubtractingFrames(0);
    }
    getLastTime() {
        return this.getTimeSubtractingFrames(1);
    }
    getLastFrame() {
        return this.sampler?.getLastFrame();
    }
    close() {
        this.sampler?.getSegment().close();
        this.sampler?.getLastFrame()?.close();
        this.file.flush();
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFyc2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2xpYi91dGlscy92aWRlby9wYXJzZXIvcGFyc2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBQyxVQUFVLEVBQUMsTUFBTSxRQUFRLENBQUM7QUFDbEMsT0FBTyxFQUFDLFlBQVksRUFBQyxNQUFNLFdBQVcsQ0FBQztBQUN2QyxPQUFPLEVBQUMsT0FBTyxFQUFDLE1BQU0sV0FBVyxDQUFDO0FBQ2xDLE9BQU8sRUFBQyxXQUFXLEVBQUMsTUFBTSxRQUFRLENBQUM7QUFFbkMsT0FBTyxFQUFDLFdBQVcsRUFBRSxnQkFBZ0IsRUFBQyxNQUFNLFNBQVMsQ0FBQztBQUV0RDs7Ozs7O0dBTUc7QUFDSCxLQUFLLFVBQVUsV0FBVyxDQUFDLEdBQVc7SUFDcEMsT0FBTyxJQUFJLE9BQU8sQ0FJZixDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsRUFBRTtRQUNkLE1BQU0sSUFBSSxHQUFHLFVBQVUsRUFBRSxDQUFDO1FBQzFCLElBQUksS0FBSyxHQUFHLEtBQUssQ0FBQztRQUNsQixNQUFNLFVBQVUsR0FBRyxJQUFJLGVBQWUsRUFBRSxDQUFDO1FBRXpDLElBQUksQ0FBQyxPQUFPLEdBQUcsQ0FBQyxJQUFTLEVBQUUsRUFBRTtZQUMzQixLQUFLLEdBQUcsSUFBSSxDQUFDO1lBQ2IsVUFBVSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBRW5CLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFFbEMsTUFBTSxNQUFNLEdBQUc7Z0JBQ2Isd0VBQXdFO2dCQUN4RSwyQkFBMkI7Z0JBQzNCLEtBQUssRUFBRSxLQUFLLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsS0FBSztnQkFDM0QsV0FBVyxFQUFFLEtBQUssQ0FBQyxL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